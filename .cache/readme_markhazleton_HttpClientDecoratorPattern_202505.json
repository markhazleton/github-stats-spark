{
  "timestamp": "2026-01-03T18:48:20.928097",
  "value": "# HttpClient Decorator Pattern for .NET\n\n[![Build and deploy ASP.Net Core app to Azure Web App - HttpClientDecoratorPattern](https://github.com/markhazleton/HttpClientDecoratorPattern/actions/workflows/main_httpclientdecoratorpattern.yml/badge.svg)](https://github.com/markhazleton/HttpClientDecoratorPattern/actions/workflows/main_httpclientdecoratorpattern.yml)\n[![NuGet](https://img.shields.io/nuget/v/WebSpark.HttpClientUtility.svg)](https://www.nuget.org/packages/WebSpark.HttpClientUtility/)\n\n## \ud83d\ude80 Enhancing HttpClient with Telemetry, Caching, and Circuit Breaking\n\nThis repository serves as a demonstration site for the public NuGet package [WebSpark.HttpClientUtility](https://www.nuget.org/packages/WebSpark.HttpClientUtility/), showcasing how to implement the Decorator Design Pattern in C# to enhance HttpClient functionality with telemetry, caching, and circuit breaking capabilities. It provides a practical, real-world example for .NET developers working with HTTP services.\n\n## \ud83d\udccb Overview\n\nThe **Decorator Pattern** is a structural design pattern that allows behavior to be added to individual objects without affecting the behavior of other objects from the same class. This repository demonstrates how this pattern is implemented in the WebSpark.HttpClientUtility package and can be applied to the HttpClient class to add cross-cutting concerns like:\n\n- **Telemetry**: Track request/response times and sizes\n- **Caching**: Reduce redundant API calls\n- **Circuit Breaking**: Prevent cascading failures during API outages\n- **Polly Integration**: Implement resilience policies\n\nBy following this pattern, the original HttpClient class remains untouched while additional functionality is layered through decorator classes, making the codebase more maintainable and adhering to the Open/Closed principle.\n\n## \ud83c\udf1f Features\n\n1. **Telemetry-Enhanced HttpClient**: Track performance metrics for all HTTP requests\n   - Response time tracking\n   - Request/response size monitoring\n   - Detailed logging with correlation IDs\n\n2. **Advanced API Interactions**:\n   - **Joke API**: Demonstrates simple API consumption with telemetry\n     ![Joke Page](https://raw.githubusercontent.com/markhazleton/HttpClientDecoratorPattern/main/Images/JokeRazorPageResults.JPG)\n\n   - **Concurrent API Calls**: Shows how to manage multiple parallel requests with SemaphoreSlim\n     ![Many Calls](https://raw.githubusercontent.com/markhazleton/HttpClientDecoratorPattern/main/Images/ListPageResults.JPG)\n\n   - **Circuit Breaking**: Protects your application from API failures\n\n3. **Additional Patterns**:\n   - Implementation of SemaphoreSlim for controlled concurrent requests\n   - Memory caching for API responses\n   - SignalR integration for real-time updates\n\n## \ud83d\udcbb Technologies Used\n\n- ASP.NET Core (.NET 9.0)\n- C# 12\n- Razor Pages\n- SignalR\n- Polly for resilience policies\n- [WebSpark.HttpClientUtility](https://www.nuget.org/packages/WebSpark.HttpClientUtility/) package providing the core implementation\n\n## \ud83d\udce6 WebSpark.HttpClientUtility NuGet Package\n\nThis demonstration site uses the WebSpark.HttpClientUtility NuGet package which provides:\n\n- `HttpRequestResult<T>` - Core class for handling HTTP requests with built-in telemetry\n- `IHttpRequestResultService` - Interface for the HTTP request service\n- `HttpRequestResultService` - Base implementation of the service\n- Decorator implementations:\n  - `HttpRequestResultServiceTelemetry` - Adds telemetry capabilities\n  - `HttpRequestResultServiceCache` - Adds caching capabilities\n  - `HttpRequestResultServicePolly` - Adds resilience policies with Polly\n\nTo use the package in your own projects:\n\n```\ndotnet add package WebSpark.HttpClientUtility\n```\n\n## \ud83e\udde9 Architecture\n\nThe implementation leverages the WebSpark.HttpClientUtility package and follows a clean decorator pattern architecture with the following components:\n\n### Core Interface from WebSpark.HttpClientUtility\n\n```csharp\npublic interface IHttpRequestResultService\n{\n    Task<HttpRequestResult<T>> HttpSendRequestResultAsync<T>(HttpRequestResult<T> requestResult, CancellationToken ct = default);\n}\n```\n\n### Base Implementation from WebSpark.HttpClientUtility\n\n```csharp\npublic class HttpRequestResultService : IHttpRequestResultService\n{\n    private readonly HttpClient _httpClient;\n    \n    public HttpRequestResultService(ILogger<HttpRequestResultService> logger, \n                                  IConfiguration configuration, \n                                  HttpClient httpClient)\n    {\n        _httpClient = httpClient;\n    }\n    \n    public async Task<HttpRequestResult<T>> HttpSendRequestResultAsync<T>(HttpRequestResult<T> requestResult, \n                                                                       CancellationToken ct = default)\n    {\n       // Base implementation of HTTP request handling\n    }\n}\n```\n\n### Decorator Implementations from WebSpark.HttpClientUtility\n\n```csharp\n// Telemetry Decorator\npublic class HttpRequestResultServiceTelemetry : IHttpRequestResultService\n{\n    private readonly IHttpRequestResultService _decoratedService;\n    \n    public HttpRequestResultServiceTelemetry(ILogger<HttpRequestResultServiceTelemetry> logger,\n                                         IHttpRequestResultService decoratedService)\n    {\n        _decoratedService = decoratedService;\n    }\n    \n    public async Task<HttpRequestResult<T>> HttpSendRequestResultAsync<T>(HttpRequestResult<T> requestResult, \n                                                                       CancellationToken ct = default)\n    {\n        // Add telemetry before and after the decorated service call\n    }\n}\n\n// Caching Decorator\npublic class HttpRequestResultServiceCache : IHttpRequestResultService\n{\n    private readonly IHttpRequestResultService _decoratedService;\n    private readonly IMemoryCache _cache;\n    \n    // Implementation with caching capability\n}\n\n// Polly Resilience Decorator\npublic class HttpRequestResultServicePolly : IHttpRequestResultService\n{\n    private readonly IHttpRequestResultService _decoratedService;\n    \n    // Implementation with Polly retry and circuit breaker policies\n}\n```\n\n### Service Registration Using WebSpark.HttpClientUtility Classes\n\n```csharp\n// Registering the layered decorators in Program.cs\nbuilder.Services.AddSingleton(serviceProvider =>\n{\n    // Base service from WebSpark.HttpClientUtility\n    IHttpRequestResultService baseService = new HttpRequestResultService(\n        /* dependencies */);\n\n    // Add Polly resilience policies from WebSpark.HttpClientUtility\n    IHttpRequestResultService pollyService = new HttpRequestResultServicePolly(\n        /* dependencies */,\n        baseService);\n\n    // Add telemetry from WebSpark.HttpClientUtility\n    IHttpRequestResultService telemetryService = new HttpRequestResultServiceTelemetry(\n        /* dependencies */,\n        pollyService);\n\n    // Add caching from WebSpark.HttpClientUtility\n    IHttpRequestResultService cacheService = new HttpRequestResultServiceCache(\n        telemetryService,\n        /* dependencies */);\n\n    return cacheService;\n});\n```\n\n## \ud83d\udea6 Getting Started\n\n1. **Prerequisites**:\n   - Visual Studio 2022 or newer\n   - .NET 9.0 SDK or newer\n\n2. **Installation**:\n\n   ```\n   git clone https://github.com/markhazleton/HttpClientDecoratorPattern.git\n   cd HttpClientDecoratorPattern\n   ```\n\n3. **Run the application**:\n   - Open the solution in Visual Studio\n   - Build and run the HttpClientDecorator.Web project\n   - Navigate through the different examples\n\n## \ud83d\udd0c API Integration Examples Using WebSpark.HttpClientUtility\n\nThis project demonstrates integration with several APIs using the WebSpark.HttpClientUtility package:\n\n- **JokeAPI**: Public API for retrieving jokes (<https://jokeapi.dev/>)\n- **Art Institute API**: Example of consuming art data\n- **NASA Picture API**: Example of image API integration\n\n## \ud83e\udd1d Contributing\n\nContributions are welcome! Please feel free to submit a Pull Request.\n\n1. Fork the repository\n2. Create your feature branch (`git checkout -b feature/amazing-feature`)\n3. Commit your changes (`git commit -m 'Add some amazing feature'`)\n4. Push to the branch (`git push origin feature/amazing-feature`)\n5. Open a Pull Request\n\nPlease review the [contributing guidelines](https://github.com/markhazleton/HttpClientDecoratorPattern/blob/main/CONTRIBUTING.md) before making pull requests.\n\n## \ud83d\udcda Learn More\n\n- [Read the Blog Post](https://markhazleton.com/decorator-pattern-http-client.html)\n- [WebSpark.HttpClientUtility on NuGet](https://www.nuget.org/packages/WebSpark.HttpClientUtility/)\n- [Live Demo](https://httpclientdecoratorpattern.azurewebsites.net/)\n\n## \ud83d\udcdc License\n\nMIT \u00a9 [Mark Hazleton](https://markhazleton.com)\n"
}