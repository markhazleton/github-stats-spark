{
  "timestamp": "2026-01-02T20:46:21.989396",
  "value": "# AsyncDemo\nVarious demos, tips and tricks for using async in C#\n\n[![Build and deploy ASP.Net Core app to Azure Web App - asyncdemo](https://github.com/markhazleton/AsyncDemo/actions/workflows/main_asyncdemo.yml/badge.svg)](https://github.com/markhazleton/AsyncDemo/actions/workflows/main_asyncdemo.yml)\n\nSample code for making and canceling Async Calls with beautiful API documentation powered by **[Scalar](https://github.com/scalar/scalar)**.\n\n## Learning Objectives\n\nThis demo teaches critical async/await patterns through focused, real-world examples. Each concept links directly to specific code you can explore:\n\n### 1. Avoiding Deadlocks\n**Where to look**: [AsyncMockService.cs:96](AsyncDemo/Services/AsyncMockService.cs#L96) - Notice the `.ConfigureAwait(false)` usage\n**What to learn**: How to prevent deadlocks in library code by not capturing the synchronization context\n**What can go wrong**: Omitting `ConfigureAwait(false)` in library code can cause deadlocks when called from UI threads. Never use `.Result` or `.Wait()` - always use `await`.\n\n### 2. Cancellation Tokens End-to-End\n**Where to look**: [RemoteController.cs:58-78](AsyncDemo.Web/Controllers/Api/RemoteController.cs#L58-L78) and [AsyncMockService.cs:80-109](AsyncDemo/Services/AsyncMockService.cs#L80-L109)\n**What to learn**: How to pass cancellation tokens from HTTP requests through the entire call chain\n**What can go wrong**: Ignoring cancellation means wasting resources on work that nobody needs anymore. Always wire `CancellationToken` through your async methods.\n\n### 3. Task.WhenAll for Concurrency\n**Where to look**: [BulkCallsController.cs:62](AsyncDemo.Web/Controllers/BulkCallsController.cs#L62)\n**What to learn**: How to execute multiple async operations concurrently and wait for all to complete\n**What can go wrong**: Using a `foreach` loop with `await` inside runs operations sequentially. Use `Task.WhenAll` to run them in parallel.\n\n### 4. Timeouts with Polly\n**Where to look**: [PollyController.cs:32-53](AsyncDemo.Web/Controllers/PollyController.cs#L32-L53)\n**What to learn**: How to implement retry policies with exponential backoff and jitter\n**What can go wrong**: Without timeouts and retries, transient failures become permanent failures. Always protect external calls.\n\n### 5. Semaphore for Throttling\n**Where to look**: [BulkCallsController.cs:28-58](AsyncDemo.Web/Controllers/BulkCallsController.cs#L28-L58)\n**What to learn**: How to limit concurrent operations using `SemaphoreSlim`\n**What can go wrong**: Unbounded concurrency can overwhelm downstream services or exhaust connection pools.\n\n### 6. Decorator Pattern for Cross-Cutting Concerns\n**Where to look**: [Program.cs:68-82](AsyncDemo.Web/Program.cs#L68-L82)\n**What to learn**: How to compose behavior (logging, caching) around async operations cleanly\n**What can go wrong**: Mixing cross-cutting concerns into business logic creates unmaintainable code.\n\n## Features\n\n- **[?] Modern API Documentation** - Beautiful, interactive API docs using Scalar\n- **[>] Async Programming Patterns** - Real-world examples of async/await best practices\n- **[!] Resilience with Polly** - Retry policies, circuit breakers, and fallback strategies\n- **[+] Decorator Pattern** - Clean, maintainable code architecture\n- **[*] OpenWeather Integration** - Live API integration examples\n- **[#] .NET 10** - Built on the latest .NET framework\n\n## API Documentation with Scalar\n\nThis project features stunning API documentation powered by **Scalar**, organized by async learning concepts. After running the application, explore:\n\n- **Interactive API Docs**: Visit `/scalar/v1` for the beautiful Scalar UI\n- **OpenAPI Specification**: Access `/openapi/v1.json` for the spec\n- **Live Demo**: [https://asyncdemo.azurewebsites.net/scalar/v1](https://asyncdemo.azurewebsites.net/scalar/v1)\n- **Learning Guide**: See [API_LEARNING_GUIDE.md](API_LEARNING_GUIDE.md) for a structured learning path\n\n### API Endpoints by Learning Concept\n\nThe API is organized into **5 learning modules**, each teaching specific async patterns:\n\n1. **Async Basics** (`/api/weather/*`) - Timeouts, cancellation, retry, and parallel calls with real weather data\n2. **Cancellation Patterns** (`/api/cancellation/*`) - Proper cancellation token usage, linked tokens, and cleanup\n3. **Concurrency & Parallelism** (`/api/concurrency/*`) - Sequential vs parallel vs throttled execution\n4. **Resilience & Timeouts** (`/api/remote/*`) - Production-ready timeout and retry patterns\n5. **Monitoring & Health** (`/status`, `/health`) - Application status and health checks\n\n**See the [API Learning Guide](API_LEARNING_GUIDE.md) for detailed endpoint documentation, learning paths, and testing guide.**\n\nScalar provides:\n- [?] Beautiful, modern UI with dark/light mode\n- [>] Auto-generated code examples in multiple languages (C#, JavaScript, Python, cURL, and more)\n- [?] Fast, responsive interface\n- [+] Advanced search and filtering\n- [+] Mobile-friendly design\n- [>] **Tags for concept-based navigation** - endpoints grouped by learning objective\n\n## Articles & Resources\n\n### Async Programming Articles\n- [Cancellation Tokens in C#](https://markhazleton.com/cancellation-token.html)\n- [Async and Decorator Pattern](https://markhazleton.com/decorator-pattern-http-client.html)\n- [Cancel Asynchronous Operations](https://johnthiriet.com/cancel-asynchronous-operation-in-csharp/)\n- [Going Async with Async Command](https://johnthiriet.com/mvvm-going-async-with-async-command/)\n\n## Hosting\nLive demo hosted at [https://asyncdemo.azurewebsites.net/](https://asyncdemo.azurewebsites.net/)\n## Additional Resources\n\n### Async & Await Best Practices\n- [Await and UI and Deadlocks](https://devblogs.microsoft.com/pfxteam/await-and-ui-and-deadlocks-oh-my/?WT.mc_id=friends-0000-jamont)\n- [Stop Calling .Result](https://montemagno.com/c-sharp-developers-stop-calling-dot-result/)\n- [Async Task with Timeout](https://codereview.stackexchange.com/questions/113108/async-task-with-timeout)\n- [Cancel Async Tasks After a Period of Time](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/cancel-async-tasks-after-a-period-of-time)\n- [Crafting a Task.TimeoutAfter Method](https://devblogs.microsoft.com/pfxteam/crafting-a-task-timeoutafter-method/)\n- [Asynchronously Wait for Task with Timeout](https://stackoverflow.com/questions/4238345/asynchronously-wait-for-taskt-to-complete-with-timeout)\n\n### Polly Resilience Resources\n- [Polly Project](http://www.thepollyproject.org/) - .NET resilience and transient-fault-handling library\n- [Using Context to Obtain Retry Count](https://www.stevejgordon.co.uk/polly-using-context-to-obtain-retry-count-diagnostics)\n- [Retry and Circuit Breaker Patterns](https://medium.com/@therealjordanlee/retry-circuit-breaker-patterns-in-c-with-polly-9aa24c5fe23a)\n\n### API Documentation\n- [Scalar Documentation](https://github.com/scalar/scalar) - Modern API documentation tool\n- [Scalar NuGet Package](https://www.nuget.org/packages/Scalar.AspNetCore)\n- [Microsoft OpenAPI Documentation](https://learn.microsoft.com/aspnet/core/fundamentals/openapi)\n\n## Getting Started\n\n1. **Clone the repository**\n   ```bash\n   git clone https://github.com/markhazleton/AsyncDemo.git\n   cd AsyncDemo\n   ```\n\n2. **Build the solution**\n   ```bash\n   dotnet build\n   ```\n\n3. **Run the web application**\n   ```bash\n   dotnet run --project AsyncDemo.Web\n   ```\n\n4. **Explore the API documentation**\n   - Open your browser to `https://localhost:5001/scalar/v1`\n   - View the beautiful Scalar-powered API documentation organized by learning concepts\n   - Try out the interactive examples in each category\n\n5. **Follow the learning path**\n   - Read the [API Learning Guide](API_LEARNING_GUIDE.md) for structured learning\n   - Start with \"Async Basics\" endpoints\n   - Progress through cancellation, concurrency, and resilience patterns\n   - Review the code references linked in endpoint descriptions\n\n6. **Run the tests**\n   ```bash\n   dotnet test\n   ```\n   - Explore tests that demonstrate resilience patterns\n   - See simulated transient failures with Polly\n   - Learn from cancellation and concurrency test examples\n\n## Technologies\n\n- **.NET 10** - Latest .NET framework\n- **ASP.NET Core** - Web framework\n- **Scalar** - Beautiful API documentation\n- **Polly** - Resilience and transient-fault-handling\n- **OpenWeatherMap API** - Weather data integration\n\n## License\n\nMIT License - see LICENSE file for details\n\n## Author\n\n**Mark Hazleton**\n- Website: [markhazleton.com](https://markhazleton.com)\n- Email: mark.hazleton@controlorigins.com\n\n---\n\n**Built with [love] on .NET 10 | Powered by Scalar API Documentation**\n\n"
}