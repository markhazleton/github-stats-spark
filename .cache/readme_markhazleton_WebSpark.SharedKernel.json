{
  "timestamp": "2026-01-02T20:48:18.135490",
  "value": "# WebSpark.SharedKernel\n\n[![NuGet](https://img.shields.io/nuget/v/WebSpark.SharedKernel.svg)](https://www.nuget.org/packages/WebSpark.SharedKernel/)\n[![NuGet Downloads](https://img.shields.io/nuget/dt/WebSpark.SharedKernel.svg)](https://www.nuget.org/packages/WebSpark.SharedKernel/)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n\nA comprehensive collection of base classes and utilities for implementing Domain-Driven Design (DDD) patterns in .NET applications. This package provides essential building blocks for clean architecture implementations, including entities, value objects, domain events, and repository abstractions.\n\n## \ud83c\udfaf Why WebSpark.SharedKernel?\n\nWebSpark.SharedKernel simplifies the implementation of common DDD patterns by providing:\n\n- **Type-safe entity base classes** with support for multiple ID types\n- **Robust value object implementation** with proper equality semantics\n- **Domain event infrastructure** with MediatR integration\n- **Repository pattern abstractions** built on WebSpark.Specification\n- **CQRS pattern support** with command and query abstractions\n- **Comprehensive logging** for all MediatR requests\n\n## \ud83d\udce6 Installation\n\n```bash\ndotnet add package WebSpark.SharedKernel\n```\n\n## \ud83d\ude80 Quick Start\n\n### 1. Create an Entity\n\n```csharp\npublic class Customer : EntityBase, IAggregateRoot\n{\n    public string Name { get; private set; }\n    public Email Email { get; private set; }\n\n    public Customer(string name, Email email)\n    {\n        Name = Guard.Against.NullOrEmpty(name);\n        Email = Guard.Against.Null(email);\n        \n        // Raise a domain event\n        RegisterDomainEvent(new CustomerCreatedEvent(Id, name));\n    }\n}\n```\n\n### 2. Create a Value Object\n\n```csharp\npublic class Email : ValueObject\n{\n    public string Value { get; }\n\n    public Email(string value)\n    {\n        Value = Guard.Against.NullOrEmpty(value);\n        Guard.Against.InvalidFormat(value, nameof(value), @\"^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$\");\n    }\n\n    protected override IEnumerable<object> GetEqualityComponents()\n    {\n        yield return Value;\n    }\n}\n```\n\n### 3. Create a Domain Event\n\n```csharp\npublic class CustomerCreatedEvent : DomainEventBase\n{\n    public int CustomerId { get; }\n    public string CustomerName { get; }\n\n    public CustomerCreatedEvent(int customerId, string customerName)\n    {\n        CustomerId = customerId;\n        CustomerName = customerName;\n    }\n}\n```\n\n### 4. Implement a Repository\n\n```csharp\npublic interface ICustomerRepository : IRepository<Customer>\n{\n    Task<Customer?> GetByEmailAsync(Email email);\n}\n```\n\n## \ud83d\udcda API Documentation\n\n### Core Entities\n\n#### `EntityBase`\n\nThe foundation for all domain entities in your application.\n\n**Key Features:**\n\n- Auto-incrementing integer ID\n- Domain event support\n- Three generic variants for different ID types\n\n**Variants:**\n\n```csharp\nEntityBase                    // int Id\nEntityBase<TId>              // Generic struct Id (Guid, long, etc.)\nEntityBase<T, TId>           // For strongly-typed IDs (Vogen support)\n```\n\n**Usage:**\n\n```csharp\n// Standard integer ID\npublic class Order : EntityBase, IAggregateRoot { }\n\n// GUID ID\npublic class Product : EntityBase<Guid>, IAggregateRoot { }\n\n// Strongly-typed ID\npublic class Invoice : EntityBase<Invoice, InvoiceId>, IAggregateRoot { }\n```\n\n#### `HasDomainEventsBase`\n\nProvides domain event functionality to entities.\n\n**Methods:**\n\n- `RegisterDomainEvent(DomainEventBase domainEvent)` - Adds a domain event\n- `DomainEvents` - Read-only collection of pending events\n- `ClearDomainEvents()` - Removes all pending events (internal use)\n\n### Value Objects\n\n#### `ValueObject`\n\nAbstract base class for implementing value objects with proper equality semantics.\n\n**Key Features:**\n\n- Structural equality based on component values\n- Hash code caching for performance\n- Comparison support (IComparable)\n- Proxy-aware equality (EF Core/NHibernate)\n\n**Implementation:**\n\n```csharp\npublic class Money : ValueObject\n{\n    public decimal Amount { get; }\n    public string Currency { get; }\n\n    public Money(decimal amount, string currency)\n    {\n        Amount = amount;\n        Currency = Guard.Against.NullOrEmpty(currency);\n    }\n\n    protected override IEnumerable<object> GetEqualityComponents()\n    {\n        yield return Amount;\n        yield return Currency;\n    }\n}\n```\n\n**\ud83d\udca1 Modern Alternative:** For C# 10+, consider using `readonly record struct` for simple value objects:\n\n```csharp\npublic readonly record struct Money(decimal Amount, string Currency);\n```\n\n### Domain Events\n\n#### `DomainEventBase`\n\nAbstract base class for all domain events.\n\n**Properties:**\n\n- `DateOccurred` - Automatically set to UTC timestamp on creation\n\n**Integration:**\n\n- Implements `INotification` from MediatR\n- Dispatched after entity persistence\n\n#### `IDomainEventDispatcher`\n\nContract for dispatching domain events.\n\n**Implementation:**\n\n```csharp\npublic async Task DispatchAndClearEvents(IEnumerable<IHasDomainEvents> entities)\n{\n    // Dispatch events and clear from entities\n}\n```\n\n#### `MediatRDomainEventDispatcher`\n\nReady-to-use MediatR implementation of domain event dispatching.\n\n**Features:**\n\n- Publishes events via MediatR\n- Comprehensive logging\n- Automatic event clearing\n- Error handling for non-conforming entities\n\n### Repository Pattern\n\n#### `IRepository<T>`\n\nFull repository interface for aggregate roots.\n\n**Inheritance:**\n\n- Extends `IRepositoryBase<T>` from WebSpark.Specification\n- Constraint: `T : class, IAggregateRoot`\n\n**Available Operations:**\n\n```csharp\n// Create\nTask<T> AddAsync(T entity);\nTask<IEnumerable<T>> AddRangeAsync(IEnumerable<T> entities);\n\n// Read\nTask<T?> GetByIdAsync<TId>(TId id);\nTask<T?> GetBySpecAsync(ISpecification<T> specification);\nTask<List<T>> ListAsync(ISpecification<T> specification);\n\n// Update\nTask UpdateAsync(T entity);\nTask UpdateRangeAsync(IEnumerable<T> entities);\n\n// Delete\nTask DeleteAsync(T entity);\nTask DeleteRangeAsync(IEnumerable<T> entities);\n\n// Queries\nTask<int> CountAsync(ISpecification<T> specification);\nTask<bool> AnyAsync(ISpecification<T> specification);\n```\n\n#### `IReadRepository<T>`\n\nRead-only repository interface.\n\n**Use Cases:**\n\n- Query services\n- Read-only operations\n- CQRS query side\n\n### CQRS Pattern Support\n\n#### Commands\n\n```csharp\n// Command definition\npublic record CreateCustomerCommand(string Name, string Email) : ICommand<int>;\n\n// Command handler\npublic class CreateCustomerHandler : ICommandHandler<CreateCustomerCommand, int>\n{\n    public async Task<int> Handle(CreateCustomerCommand request, CancellationToken cancellationToken)\n    {\n        // Implementation\n    }\n}\n```\n\n#### Queries\n\n```csharp\n// Query definition\npublic record GetCustomerQuery(int Id) : IQuery<CustomerDto>;\n\n// Query handler\npublic class GetCustomerHandler : IQueryHandler<GetCustomerQuery, CustomerDto>\n{\n    public async Task<CustomerDto> Handle(GetCustomerQuery request, CancellationToken cancellationToken)\n    {\n        // Implementation\n    }\n}\n```\n\n### Interfaces\n\n#### `IAggregateRoot`\n\nMarker interface for aggregate root entities.\n\n**Purpose:**\n\n- Identifies aggregate boundaries\n- Repository constraints\n- Domain event origination\n\n#### `IHasDomainEvents`\n\nContract for entities that can raise domain events.\n\n**Properties:**\n\n- `IReadOnlyCollection<DomainEventBase> DomainEvents`\n\n### Behaviors\n\n#### `LoggingBehavior<TRequest, TResponse>`\n\nMediatR pipeline behavior for comprehensive request logging.\n\n**Features:**\n\n- Request/response logging\n- Execution time tracking\n- Property value inspection (via reflection)\n- Configurable log levels\n\n**Registration (Autofac example):**\n\n```csharp\nbuilder\n    .RegisterGeneric(typeof(LoggingBehavior<,>))\n    .As(typeof(IPipelineBehavior<,>))\n    .InstancePerLifetimeScope();\n```\n\n## \ud83c\udfd7\ufe0f Architecture Integration\n\n### Entity Framework Core\n\n```csharp\npublic class ApplicationDbContext : DbContext\n{\n    private readonly IDomainEventDispatcher _dispatcher;\n\n    public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options, \n                               IDomainEventDispatcher dispatcher) : base(options)\n    {\n        _dispatcher = dispatcher;\n    }\n\n    public override async Task<int> SaveChangesAsync(CancellationToken cancellationToken = default)\n    {\n        var entitiesWithEvents = ChangeTracker.Entries<IHasDomainEvents>()\n            .Select(e => e.Entity)\n            .Where(e => e.DomainEvents.Any())\n            .ToArray();\n\n        var result = await base.SaveChangesAsync(cancellationToken);\n        \n        await _dispatcher.DispatchAndClearEvents(entitiesWithEvents);\n        \n        return result;\n    }\n}\n```\n\n### Dependency Injection\n\n```csharp\n// Program.cs or Startup.cs\nservices.AddScoped<IDomainEventDispatcher, MediatRDomainEventDispatcher>();\nservices.AddScoped(typeof(IPipelineBehavior<,>), typeof(LoggingBehavior<,>));\n```\n\n## \ud83d\udd27 Dependencies\n\nThis package relies on these well-established libraries:\n\n- **[MediatR](https://github.com/jbogard/MediatR)** (12.5.0) - Mediator pattern implementation\n- **[WebSpark.Specification](https://github.com/ardalis/Specification)** (9.1.0) - Repository pattern with specifications\n- **[WebSpark.GuardClauses](https://github.com/ardalis/GuardClauses)** (5.0.0) - Guard clause extensions\n- **[Microsoft.Extensions.Logging.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions)** (9.0.5) - Logging abstractions\n\n## \ud83d\udccb Requirements\n\n- **.NET 8.0+** - Built with modern .NET features\n- **C# 10+** - Utilizes recent language enhancements\n- **Nullable reference types** - Enabled for better null safety\n\n## \ud83c\udfc6 Best Practices\n\n### 1. Create Your Own SharedKernel\n\n> **Important:** This package is intended as a starting point and reference implementation. For production applications, create your own `YourCompany.SharedKernel` package with customizations specific to your domain.\n\n### 2. Value Object Guidelines\n\n- Use `readonly record struct` for simple value objects in C# 10+\n- Inherit from `ValueObject` for complex scenarios requiring custom behavior\n- Always validate input in constructors\n- Make properties immutable\n\n### 3. Entity Design\n\n- Keep entities focused on their core business logic\n- Use domain events for cross-aggregate communication\n- Implement `IAggregateRoot` only on true aggregate roots\n- Prefer composition over inheritance\n\n### 4. Repository Usage\n\n- Use specifications for complex queries\n- Keep repositories focused on aggregate roots\n- Implement custom repository interfaces for domain-specific operations\n- Use `IReadRepository<T>` for read-only scenarios\n\n## \ud83e\uddea Testing\n\nThe package includes comprehensive unit tests demonstrating proper usage patterns:\n\n```bash\n# Run tests\ndotnet test\n\n# Run with coverage\ndotnet test --collect:\"XPlat Code Coverage\"\n```\n\n## \ud83d\udcd6 Examples and Templates\n\nFor complete implementation examples, see:\n\n- **[Clean Architecture Template](https://github.com/ardalis/cleanarchitecture)** - Complete solution template\n- **[NimblePros.SharedKernel](https://github.com/NimblePros/SharedKernelSample)** - Production example\n\n## \ud83e\udd1d Contributing\n\nContributions are welcome! Please:\n\n1. Fork the repository\n2. Create a feature branch\n3. Add tests for new functionality\n4. Ensure all tests pass\n5. Submit a pull request\n\n## \ud83d\udcc4 License\n\nThis project is licensed under the [MIT License](LICENSE).\n\n## \ud83d\ude4f Acknowledgments\n\nCreated by [Steve Smith (@ardalis)](https://github.com/ardalis) as part of the Clean Architecture ecosystem.\n\nSpecial thanks to the community contributors and the teams behind MediatR, Specification pattern, and other foundational libraries.\n\n---\n\n## \ud83d\udd17 Related Projects\n\n- [Clean Architecture Solution Template](https://github.com/ardalis/cleanarchitecture)\n- [WebSpark.Specification](https://github.com/ardalis/Specification)\n- [WebSpark.GuardClauses](https://github.com/ardalis/GuardClauses)\n- [WebSpark.Result](https://github.com/ardalis/Result)\n\n---\n\n**\ud83d\udca1 Pro Tip:** Star this repository to stay updated with the latest DDD and Clean Architecture patterns!\n"
}