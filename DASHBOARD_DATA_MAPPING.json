{
  "metadata": {
    "title": "Stats Spark → Dashboard Data Mapping",
    "date": "2025-12-31",
    "purpose": "Quick reference for mapping existing Stats Spark outputs to dashboard requirements"
  },

  "table_columns_mapping": {
    "existing_columns": [
      {
        "dashboard_column": "Repository Name",
        "source_module": "spark.models.Repository",
        "source_field": "name",
        "data_type": "string",
        "example": "git-spark",
        "status": "✅ Complete",
        "notes": "Direct field access"
      },
      {
        "dashboard_column": "Primary Language",
        "source_module": "spark.models.Repository",
        "source_field": "primary_language",
        "data_type": "string",
        "example": "TypeScript",
        "status": "✅ Complete",
        "notes": "From GitHub language detection"
      },
      {
        "dashboard_column": "First Commit Date",
        "source_module": "spark.models.Repository + CommitHistory",
        "source_field": "created_at (fallback) or first_commit_date (when implemented)",
        "data_type": "ISO datetime",
        "example": "2023-01-15T10:30:00Z",
        "status": "⚠️ Partial - Uses created_at as fallback",
        "implementation_effort": "30 minutes",
        "notes": "created_at is repository creation date, not first commit. Need to calculate from commit history."
      },
      {
        "dashboard_column": "Last Commit Date",
        "source_module": "spark.models.Repository",
        "source_field": "pushed_at",
        "data_type": "ISO datetime",
        "example": "2025-12-29T14:22:00Z",
        "status": "✅ Complete",
        "notes": "Last push timestamp from GitHub API"
      },
      {
        "dashboard_column": "Total Commits",
        "source_module": "spark.models.CommitHistory",
        "source_field": "total_commits",
        "data_type": "integer",
        "example": 127,
        "status": "✅ Complete",
        "notes": "Lifetime commit count"
      },
      {
        "dashboard_column": "Commits (90 days)",
        "source_module": "spark.models.CommitHistory",
        "source_field": "recent_90d",
        "data_type": "integer",
        "example": 12,
        "status": "✅ Complete",
        "notes": "Recent activity window"
      },
      {
        "dashboard_column": "Commit Frequency",
        "source_module": "spark.models.CommitHistory",
        "source_field": "commit_frequency",
        "data_type": "float",
        "example": 27.0,
        "status": "✅ Complete",
        "notes": "Commits per month (calculated from recent_90d)"
      },
      {
        "dashboard_column": "Stars",
        "source_module": "spark.models.Repository",
        "source_field": "stars",
        "data_type": "integer",
        "example": 5,
        "status": "✅ Complete",
        "notes": "Star count from GitHub API"
      },
      {
        "dashboard_column": "Forks",
        "source_module": "spark.models.Repository",
        "source_field": "forks",
        "data_type": "integer",
        "example": 2,
        "status": "✅ Complete",
        "notes": "Fork count from GitHub API"
      },
      {
        "dashboard_column": "Watchers",
        "source_module": "spark.models.Repository",
        "source_field": "watchers",
        "data_type": "integer",
        "example": 8,
        "status": "✅ Complete",
        "notes": "Watcher count from GitHub API"
      },
      {
        "dashboard_column": "Size (KB)",
        "source_module": "spark.models.Repository",
        "source_field": "size_kb",
        "data_type": "integer",
        "example": 1282,
        "status": "✅ Complete",
        "notes": "Repository size in kilobytes"
      },
      {
        "dashboard_column": "Last Updated",
        "source_module": "spark.models.Repository",
        "source_field": "updated_at",
        "data_type": "ISO datetime",
        "example": "2025-12-29T14:22:00Z",
        "status": "✅ Complete",
        "notes": "Any change timestamp (broader than pushed_at)"
      },
      {
        "dashboard_column": "Contributors",
        "source_module": "spark.models.Repository",
        "source_field": "contributors_count",
        "data_type": "integer",
        "example": 3,
        "status": "✅ Complete",
        "notes": "Unique contributor count"
      },
      {
        "dashboard_column": "Language Count",
        "source_module": "spark.models.Repository",
        "source_field": "language_count",
        "data_type": "integer",
        "example": 5,
        "status": "✅ Complete",
        "notes": "Number of distinct programming languages"
      },
      {
        "dashboard_column": "Has License",
        "source_module": "spark.models.Repository",
        "source_field": "has_license",
        "data_type": "boolean",
        "example": true,
        "status": "✅ Complete",
        "notes": "License file presence indicator"
      },
      {
        "dashboard_column": "Has Docs",
        "source_module": "spark.models.Repository",
        "source_field": "has_docs",
        "data_type": "boolean",
        "example": true,
        "status": "✅ Complete",
        "notes": "Documentation presence indicator"
      },
      {
        "dashboard_column": "Has Tests",
        "source_module": "spark.models.Repository",
        "source_field": "has_tests",
        "data_type": "boolean",
        "example": true,
        "status": "✅ Complete",
        "notes": "Test directory presence indicator"
      },
      {
        "dashboard_column": "Has CI/CD",
        "source_module": "spark.models.Repository",
        "source_field": "has_ci_cd",
        "data_type": "boolean",
        "example": true,
        "status": "✅ Complete",
        "notes": "GitHub Actions workflow presence"
      }
    ],

    "missing_columns": [
      {
        "dashboard_column": "Average Commit Size",
        "required_for": "FR-006, table column, visualization",
        "measurement": "Average (files_changed + lines_added + lines_deleted) per commit",
        "data_type": "float",
        "example": 12.5,
        "status": "❌ Missing",
        "implementation_effort": "2-3 hours",
        "implementation_steps": [
          "Extend fetcher.fetch_commits() to retrieve commit details",
          "Create CommitSize dataclass with files/lines metrics",
          "Add calculation method to StatsCalculator",
          "Cache results to avoid excessive API calls"
        ],
        "blocking_features": [
          "Table 'Average Commit Size' column",
          "Commit size distribution chart",
          "Repository size comparison"
        ]
      },
      {
        "dashboard_column": "Biggest Commit (Size)",
        "required_for": "FR-007, table column, top commits visualization",
        "measurement": "Maximum commit size in repository",
        "data_type": "object {size: float, sha: string, date: datetime}",
        "example": {
          "size": 245,
          "sha": "a1b2c3d4",
          "date": "2025-12-15T10:00:00Z"
        },
        "status": "❌ Missing",
        "implementation_effort": "2-3 hours",
        "implementation_steps": [
          "Fetch all commits with change statistics",
          "Calculate size per commit",
          "Track maximum with commit metadata",
          "Add BiggestCommit field to Repository model"
        ],
        "blocking_features": [
          "Table 'Biggest Commit' column",
          "Biggest commits ranking",
          "Outlier analysis"
        ]
      },
      {
        "dashboard_column": "Smallest Commit (Size)",
        "required_for": "FR-008, table column",
        "measurement": "Minimum commit size in repository",
        "data_type": "object {size: float, sha: string, date: datetime}",
        "example": {
          "size": 1,
          "sha": "e4f5g6h7",
          "date": "2025-12-20T15:30:00Z"
        },
        "status": "❌ Missing",
        "implementation_effort": "2-3 hours (shares implementation with Biggest Commit)",
        "implementation_steps": [
          "Calculated alongside Biggest Commit",
          "Track minimum with commit metadata",
          "Add SmallestCommit field to Repository model"
        ],
        "blocking_features": [
          "Table 'Smallest Commit' column",
          "Commit consistency analysis"
        ]
      }
    ]
  },

  "data_model_fields": {
    "Repository_model": {
      "fields": [
        { "name": "name", "type": "str", "dashboard_use": "table, detail view" },
        { "name": "description", "type": "Optional[str]", "dashboard_use": "detail view" },
        { "name": "url", "type": "str", "dashboard_use": "table link, detail view" },
        { "name": "created_at", "type": "datetime", "dashboard_use": "table (as fallback), detail view" },
        { "name": "updated_at", "type": "datetime", "dashboard_use": "table, detail view" },
        { "name": "pushed_at", "type": "Optional[datetime]", "dashboard_use": "table (last commit), detail view" },
        { "name": "primary_language", "type": "Optional[str]", "dashboard_use": "table (language), filtering" },
        { "name": "language_stats", "type": "Dict[str, int]", "dashboard_use": "detail view (breakdown)" },
        { "name": "stars", "type": "int", "dashboard_use": "table, sorting, chart" },
        { "name": "forks", "type": "int", "dashboard_use": "table, detail view" },
        { "name": "watchers", "type": "int", "dashboard_use": "table, detail view" },
        { "name": "open_issues", "type": "int", "dashboard_use": "detail view" },
        { "name": "is_archived", "type": "bool", "dashboard_use": "filtering, visual indicator" },
        { "name": "is_fork", "type": "bool", "dashboard_use": "filtering, visual indicator" },
        { "name": "has_readme", "type": "bool", "dashboard_use": "quality indicator" },
        { "name": "size_kb", "type": "int", "dashboard_use": "table, sorting, chart" },
        { "name": "contributors_count", "type": "int", "dashboard_use": "table, detail view" },
        { "name": "language_count", "type": "int", "dashboard_use": "diversity metric" },
        { "name": "has_ci_cd", "type": "bool", "dashboard_use": "quality badge" },
        { "name": "has_tests", "type": "bool", "dashboard_use": "quality badge" },
        { "name": "has_license", "type": "bool", "dashboard_use": "quality badge, table" },
        { "name": "has_docs", "type": "bool", "dashboard_use": "quality badge" },
        { "name": "release_count", "type": "int", "dashboard_use": "detail view" },
        { "name": "latest_release_date", "type": "Optional[datetime]", "dashboard_use": "detail view" },
        { "name": "commit_velocity", "type": "Optional[float]", "dashboard_use": "activity metric" }
      ]
    },

    "CommitHistory_model": {
      "fields": [
        { "name": "repository_name", "type": "str", "dashboard_use": "linking to repo" },
        { "name": "total_commits", "type": "int", "dashboard_use": "table, sorting, chart" },
        { "name": "recent_90d", "type": "int", "dashboard_use": "recent activity" },
        { "name": "recent_180d", "type": "int", "dashboard_use": "medium-term activity" },
        { "name": "recent_365d", "type": "int", "dashboard_use": "yearly activity" },
        { "name": "last_commit_date", "type": "Optional[datetime]", "dashboard_use": "table (alternative to pushed_at)" },
        { "name": "patterns", "type": "List[str]", "dashboard_use": "activity classification tags" },
        { "name": "commit_frequency", "type": "float", "dashboard_use": "table, sorting" },
        { "name": "consistency_score", "type": "int", "dashboard_use": "detail view" }
      ],
      "computed_properties": [
        { "name": "activity_rate", "type": "float", "description": "commits per day (90d)" },
        { "name": "days_since_last_commit", "type": "Optional[int]", "description": "recency metric" }
      ]
    }
  },

  "module_integration_checklist": {
    "GitHubFetcher": {
      "reusability": "⭐⭐⭐⭐⭐ Direct Use",
      "methods_to_use": [
        "fetch_user_profile()",
        "fetch_repositories()",
        "fetch_commits()",
        "fetch_languages()",
        "fetch_commit_counts()"
      ],
      "methods_to_extend": [
        {
          "name": "fetch_commit_details()",
          "purpose": "Get files changed and lines added/deleted per commit",
          "implementation": "New method, ~150 lines"
        }
      ],
      "integration_notes": "No breaking changes needed; purely additive"
    },

    "StatsCalculator": {
      "reusability": "⭐⭐⭐⭐ Very Good",
      "methods_to_use": [
        "calculate_statistics()",
        "calculate_spark_score()",
        "analyze_time_patterns()",
        "aggregate_languages()",
        "calculate_streaks()"
      ],
      "methods_to_extend": [
        {
          "name": "calculate_commit_metrics()",
          "purpose": "Calculate average, biggest, smallest commit sizes",
          "implementation": "New method, ~100 lines"
        }
      ],
      "integration_notes": "Existing methods provide most metrics needed"
    },

    "StatisticsVisualizer": {
      "reusability": "⭐⭐⭐⭐ Very Good",
      "methods_to_use": [
        "generate_overview()",
        "generate_heatmap()",
        "generate_languages()",
        "generate_streaks()",
        "generate_fun()",
        "generate_release()"
      ],
      "integration_notes": "Can embed SVGs as data URIs in dashboard JSON or reference by file path"
    },

    "APICache": {
      "reusability": "⭐⭐⭐⭐⭐ Direct Use",
      "methods_to_use": [
        "get()",
        "set()",
        "clear()",
        "is_expired()"
      ],
      "integration_notes": "Extend TTL for dashboard data (1 hour instead of 6 hours for faster updates)"
    },

    "RepositorySummarizer": {
      "reusability": "⭐⭐⭐⭐ Very Good",
      "methods_to_use": [
        "summarize_repository()",
        "batch_summarize()"
      ],
      "integration_notes": "Use existing summaries from markdown report or regenerate for drill-down views"
    }
  },

  "json_output_schemas": {
    "main_dashboard_data_json": {
      "filename": "data/repositories.json",
      "structure": {
        "generated_at": "2025-12-31T20:00:00Z",
        "version": "1.0.0",
        "user": {
          "spark_score": 75,
          "total_repos": 48,
          "total_commits": 5247,
          "active_repos_90d": 28,
          "primary_languages": ["Python", "TypeScript", "C#"],
          "activity_pattern": "active"
        },
        "repositories": [
          {
            "id": 1,
            "rank": 1,
            "name": "git-spark",
            "url": "https://github.com/markhazleton/git-spark",
            "language": "TypeScript",
            "created_date": "2025-09-29",
            "first_commit_date": "2025-09-29",
            "last_commit_date": "2025-12-29",
            "metrics": {
              "stars": 0,
              "forks": 0,
              "watchers": 0,
              "commits": {
                "total": 81,
                "recent_90d": 27,
                "frequency": 9.0
              },
              "size_kb": 1282,
              "contributors": 0,
              "languages_count": 5
            },
            "quality": {
              "has_license": false,
              "has_docs": true,
              "has_tests": false,
              "has_ci_cd": true
            },
            "status": "active"
          }
        ]
      },
      "size_concern": "Large datasets (200 repos) may exceed limits; consider pagination"
    },

    "repository_detail_json": {
      "filename": "data/details/{repo-name}.json",
      "structure": {
        "name": "git-spark",
        "metadata": {
          "url": "https://github.com/markhazleton/git-spark",
          "created_at": "2025-09-29",
          "last_commit": "2025-12-29",
          "is_archived": false,
          "is_fork": false
        },
        "analysis": {
          "technical_summary": "Git Spark is a sophisticated...",
          "quality_score": 78,
          "quality_indicators": {
            "license": false,
            "documentation": true,
            "tests": false,
            "ci_cd": true
          }
        },
        "metrics": {
          "commits": {
            "total": 81,
            "recent": { "90d": 27, "180d": 45, "365d": 81 },
            "average_size": 12.5,
            "biggest": { "size": 245, "sha": "a1b2c3d4", "date": "2025-12-15" },
            "smallest": { "size": 1, "sha": "e4f5g6h7", "date": "2025-12-20" },
            "frequency": 9.0
          },
          "contributors": 0,
          "languages": {
            "TypeScript": 45.2,
            "Python": 30.1,
            "CSS": 15.3,
            "JavaScript": 5.2,
            "Other": 4.2
          },
          "releases": 3,
          "last_release": "2025-12-20"
        }
      }
    }
  },

  "performance_considerations": {
    "api_calls_optimization": {
      "challenge": "Fetching commit details for 200 repos × 100 commits each = 20,000 API calls",
      "mitigation": [
        "Cache aggressively (1 hour TTL for dashboard)",
        "Implement parallel/async fetching",
        "Batch API calls using GitHub GraphQL",
        "Skip commit details for inactive repos",
        "Implement incremental updates (only changed repos)"
      ]
    },

    "json_payload_size": {
      "challenge": "200 repositories × 5KB per repo = 1MB+ payload",
      "mitigation": [
        "Split into main repo list + individual detail files",
        "Lazy load detail views on demand",
        "Use IndexedDB for client-side caching",
        "Gzip compression (GitHub Pages support)",
        "Implement pagination (50 repos per page)"
      ]
    },

    "rendering_performance": {
      "challenge": "Rendering 200+ row table with charts and animations",
      "mitigation": [
        "Virtual scrolling (render only visible rows)",
        "Defer animations until idle",
        "Use requestAnimationFrame for smooth transitions",
        "Lazy load chart libraries",
        "Implement progressive enhancement"
      ]
    }
  },

  "migration_steps": {
    "step_1_extract": {
      "description": "Extract data from existing Stats Spark outputs",
      "source_files": [
        "output/reports/markhazleton-analysis.md",
        "output/*.svg",
        "cache/repositories.json (if exists)"
      ],
      "output": "Intermediate data structures (Python objects)"
    },

    "step_2_transform": {
      "description": "Transform extracted data into dashboard formats",
      "transformations": [
        "Repository → DashboardTableRow",
        "CommitHistory → MetricsObject",
        "RepositoryAnalysis → DetailViewData",
        "SVGs → DataURIs or FileReferences"
      ]
    },

    "step_3_generate_json": {
      "description": "Generate optimized JSON payloads",
      "outputs": [
        "repositories.json (main table data)",
        "details/{repo-name}.json (per-repository)",
        "config.json (dashboard configuration)"
      ]
    },

    "step_4_render_html": {
      "description": "Render HTML templates with embedded data",
      "templates": [
        "index.html (main dashboard)",
        "detail.html (repository detail view)"
      ]
    }
  }
}
