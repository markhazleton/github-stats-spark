# Data Model: Mobile-First Front-End Redesign

**Feature**: `001-mobile-first-redesign` | **Date**: 2026-01-03

## Overview

This document defines the data structures, state management, and entity relationships for the mobile-first redesign. The frontend operates on static JSON data files generated by the Python backend and implements client-side caching, state management, and UI component data models.

## Core Entities

### 1. Viewport Configuration

**Purpose**: Define responsive breakpoint system for mobile-first layout

**Fields**:
- `name`: string - Breakpoint name (xs, sm, md, lg, xl)
- `minWidth`: number - Minimum viewport width in pixels
- `maxWidth`: number | null - Maximum viewport width (null for unbounded)
- `isMobile`: boolean - Whether this breakpoint is considered mobile
- `columns`: number - Grid column count for this breakpoint

**State Management**: React Context (`ViewportContext`)

**Example**:
```javascript
{
  breakpoints: [
    { name: 'xs', minWidth: 0, maxWidth: 319, isMobile: true, columns: 1 },
    { name: 'sm', minWidth: 320, maxWidth: 767, isMobile: true, columns: 1 },
    { name: 'md', minWidth: 768, maxWidth: 1023, isMobile: false, columns: 2 },
    { name: 'lg', minWidth: 1024, maxWidth: 1279, isMobile: false, columns: 3 },
    { name: 'xl', minWidth: 1280, maxWidth: null, isMobile: false, columns: 4 }
  ],
  current: 'sm'
}
```

**Validation Rules**:
- `minWidth` must be >= 0
- Breakpoints must not overlap
- At least one breakpoint with `isMobile: true` required

---

### 2. Touch Target

**Purpose**: Ensure all interactive elements meet minimum touch size requirements

**Fields**:
- `id`: string - Unique identifier
- `element`: React.RefObject - DOM element reference
- `minWidth`: number - Minimum width (default 44px)
- `minHeight`: number - Minimum height (default 44px)
- `spacing`: number - Minimum spacing from adjacent targets (default 8px)
- `label`: string - Accessible label
- `feedback`: TouchFeedback - Visual/haptic feedback configuration

**TouchFeedback**:
```javascript
{
  visual: boolean,        // Show visual ripple/highlight
  haptic: boolean,        // Vibrate on touch (Android)
  duration: number,       // Feedback duration in ms
  color: string          // Feedback color (CSS)
}
```

**Validation Rules**:
- `minWidth >= 44`, `minHeight >= 44` (WCAG 2.5.5 AAA)
- `spacing >= 8` to prevent mis-taps
- `label` must be non-empty string

---

### 3. Tab Bar Navigation

**Purpose**: Fixed bottom navigation for primary application sections

**Fields**:
- `tabs`: TabItem[] - Navigation tab items
- `activeTab`: string - Currently active tab ID
- `position`: 'bottom' | 'top' - Bar position (default 'bottom')
- `sticky`: boolean - Whether bar is fixed positioned

**TabItem**:
```javascript
{
  id: string,               // Unique tab identifier
  label: string,            // Display label
  icon: React.ComponentType, // Icon component
  route: string,            // Navigation route
  badge?: number,           // Optional badge count
  ariaLabel: string,        // Accessibility label
  touchTarget: TouchTarget  // Touch target config
}
```

**State Management**: React Router + useState

**Example**:
```javascript
{
  tabs: [
    {
      id: 'dashboard',
      label: 'Dashboard',
      icon: DashboardIcon,
      route: '/',
      ariaLabel: 'Navigate to Dashboard'
    },
    {
      id: 'compare',
      label: 'Compare',
      icon: CompareIcon,
      route: '/compare',
      badge: 3,
      ariaLabel: 'Navigate to Compare (3 repositories selected)'
    },
    {
      id: 'visualizations',
      label: 'Charts',
      icon: ChartIcon,
      route: '/visualizations',
      ariaLabel: 'Navigate to Visualizations'
    }
  ],
  activeTab: 'dashboard',
  position: 'bottom',
  sticky: true
}
```

**Validation Rules**:
- 3-4 tabs maximum (mobile best practice)
- Each tab must have unique `id`
- All tabs must have valid `route`

---

### 4. Bottom Sheet

**Purpose**: Mobile-native modal pattern for filters, actions, and details

**Fields**:
- `id`: string - Unique sheet identifier
- `isOpen`: boolean - Visibility state
- `content`: React.ReactNode - Sheet content
- `snapPoints`: number[] - Snap heights as viewport percentage [0.25, 0.5, 0.9]
- `currentSnap`: number - Current snap point index
- `dismissible`: boolean - Can be dismissed by swipe/backdrop tap
- `backdrop`: boolean - Show dimmed backdrop
- `onDismiss`: () => void - Dismiss callback

**State Management**: Custom hook `useBottomSheet()`

**Example**:
```javascript
{
  id: 'filter-sheet',
  isOpen: true,
  content: <FilterForm />,
  snapPoints: [0.4, 0.9],
  currentSnap: 0,
  dismissible: true,
  backdrop: true,
  onDismiss: () => setIsOpen(false)
}
```

**Validation Rules**:
- `snapPoints` must be ascending array of 0.0-1.0 values
- At least one snap point required
- `currentSnap` must be valid index into `snapPoints`

---

### 5. Repository Card

**Purpose**: Mobile-optimized card layout for repository display

**Fields**:
- `repository`: Repository - Repository data (from backend JSON)
- `variant`: 'collapsed' | 'expanded' - Display state
- `selectable`: boolean - Show selection checkbox
- `selected`: boolean - Current selection state
- `onSelect`: (id: string) => void - Selection callback
- `onExpand`: (id: string) => void - Expansion callback

**Repository** (from backend data):
```javascript
{
  id: string,
  name: string,
  description: string | null,
  language: string,
  stars: number,
  forks: number,
  lastCommitDate: string,        // ISO 8601
  commits: number,
  contributors: number,
  technologies: string[],
  url: string
}
```

**Collapsed State Display**:
- Repository name
- Primary language badge
- Stars count
- Last commit date (relative, e.g., "3 days ago")
- Selection checkbox (if `selectable`)

**Expanded State Display**:
- All collapsed state fields
- Full description
- Commit history (last 5 commits)
- Technology stack badges
- Metrics (commits, contributors, forks)

**State Management**: Component state (useState)

**Validation Rules**:
- `repository.name` required
- `repository.language` required
- `repository.stars >= 0`
- `repository.lastCommitDate` must be valid ISO 8601

---

### 6. Gesture Handler

**Purpose**: Touch event processing for swipe, drag, long-press gestures

**Fields**:
- `type`: GestureType - Gesture type to recognize
- `threshold`: number - Minimum distance/duration for recognition
- `onGesture`: (event: GestureEvent) => void - Gesture callback
- `enabled`: boolean - Whether gesture detection is active

**GestureType**: `'swipe-left' | 'swipe-right' | 'swipe-up' | 'swipe-down' | 'long-press' | 'drag'`

**GestureEvent**:
```javascript
{
  type: GestureType,
  target: HTMLElement,
  direction?: 'left' | 'right' | 'up' | 'down',
  distance?: number,        // For swipe/drag
  duration?: number,        // For long-press
  velocity?: number,        // For swipe
  pointerPosition: { x: number, y: number }
}
```

**State Management**: Custom hook `useGesture()` (wraps @use-gesture/react)

**Example**:
```javascript
{
  type: 'swipe-left',
  threshold: 50,            // 50px minimum swipe distance
  onGesture: (e) => handleSwipeDelete(e.target.dataset.id),
  enabled: true
}
```

**Validation Rules**:
- `threshold > 0`
- Valid `GestureType`
- `onGesture` must be function

---

### 7. Loading State

**Purpose**: Progressive loading indicators with skeleton screens

**Fields**:
- `type`: LoadingType - Type of loading indicator
- `variant`: 'skeleton' | 'spinner' | 'progressive' - Visual style
- `count`: number - Number of skeleton items (for lists)
- `duration`: number - Animation duration in ms

**LoadingType**: `'card' | 'table' | 'chart' | 'text' | 'list'`

**Skeleton Dimensions** (for card variant):
```javascript
{
  titleWidth: '60%',
  badgeWidth: '80px',
  metaWidth: '40%',
  height: '120px'
}
```

**State Management**: Component state

**Example**:
```javascript
{
  type: 'card',
  variant: 'skeleton',
  count: 5,
  duration: 1500
}
```

---

### 8. Empty State

**Purpose**: Display when filters/search result in zero items

**Fields**:
- `icon`: React.ComponentType - Illustration component
- `title`: string - Primary message
- `description`: string | null - Secondary message
- `action`: EmptyStateAction | null - Optional action button

**EmptyStateAction**:
```javascript
{
  label: string,
  onClick: () => void,
  variant: 'primary' | 'secondary',
  icon?: React.ComponentType
}
```

**Example**:
```javascript
{
  icon: EmptySearchIcon,
  title: 'No repositories found',
  description: 'Try adjusting your filters or search criteria',
  action: {
    label: 'Clear filters',
    onClick: () => clearAllFilters(),
    variant: 'primary'
  }
}
```

**Validation Rules**:
- `title` required, non-empty
- `action.label` required if action present

---

### 9. Offline Cache

**Purpose**: IndexedDB storage for offline repository data access

**Fields**:
- `storeName`: string - IndexedDB object store name
- `entries`: CacheEntry[] - Cached data entries
- `maxAge`: number - Cache TTL in milliseconds (7 days)

**CacheEntry**:
```javascript
{
  key: string,              // Cache key (e.g., 'repositories-list')
  data: any,                // Cached data
  timestamp: number,        // Cache creation time (Unix ms)
  version: string,          // Data schema version
  size: number              // Entry size in bytes
}
```

**Operations**:
- `get(key: string): Promise<any>` - Retrieve cached data
- `set(key: string, data: any): Promise<void>` - Store data
- `delete(key: string): Promise<void>` - Remove entry
- `clear(): Promise<void>` - Clear all entries
- `cleanup(): Promise<void>` - Remove entries older than maxAge

**State Management**: Custom hook `useOfflineCache()` + Dexie.js

**Example**:
```javascript
{
  storeName: 'github-stats-cache',
  entries: [
    {
      key: 'repositories-list',
      data: [ /* repository objects */ ],
      timestamp: 1735826400000,
      version: '1.0.0',
      size: 245678
    }
  ],
  maxAge: 604800000  // 7 days in milliseconds
}
```

**Validation Rules**:
- `maxAge >= 0`
- Automatic cleanup on read operations
- Version mismatch triggers cache invalidation

---

### 10. Performance Budget

**Purpose**: Enforce bundle size and performance thresholds

**Fields**:
- `jsBundle`: BudgetMetric - JavaScript bundle constraints
- `cssBundle`: BudgetMetric - CSS bundle constraints
- `timeToInteractive`: BudgetMetric - TTI performance budget
- `firstContentfulPaint`: BudgetMetric - FCP performance budget
- `cumulativeLayoutShift`: BudgetMetric - CLS visual stability

**BudgetMetric**:
```javascript
{
  target: number,           // Target value
  limit: number,            // Maximum acceptable value
  current: number,          // Current measurement
  unit: string,             // Measurement unit
  status: 'pass' | 'warn' | 'fail'
}
```

**Example**:
```javascript
{
  jsBundle: {
    target: 150000,         // 150KB
    limit: 170000,          // 170KB max
    current: 165432,
    unit: 'bytes',
    status: 'warn'
  },
  cssBundle: {
    target: 40000,          // 40KB
    limit: 50000,           // 50KB max
    current: 38291,
    unit: 'bytes',
    status: 'pass'
  },
  timeToInteractive: {
    target: 4000,           // 4s
    limit: 5000,            // 5s max
    current: 4823,
    unit: 'milliseconds',
    status: 'warn'
  },
  firstContentfulPaint: {
    target: 1500,           // 1.5s
    limit: 2000,            // 2s max
    current: 1721,
    unit: 'milliseconds',
    status: 'warn'
  },
  cumulativeLayoutShift: {
    target: 0.05,
    limit: 0.1,
    current: 0.08,
    unit: 'score',
    status: 'warn'
  }
}
```

**Monitoring**: Lighthouse CI in GitHub Actions

---

## State Management Architecture

### Global State (React Context)

**ViewportContext**:
- Current breakpoint
- Window dimensions
- Orientation (portrait/landscape)
- Is mobile device

**ThemeContext**:
- Current theme (light/dark/system)
- Safe area insets
- Color scheme preferences

**OfflineCacheContext**:
- Cache status (online/offline)
- Last sync timestamp
- Pending sync operations

### Local Component State (useState)

- Bottom sheet visibility
- Repository card expansion
- Selection state
- Loading states
- Form inputs

### URL State (React Router)

- Current route
- Tab selection
- Filter parameters (query strings)

---

## Data Flow

```
1. User Action (touch, swipe, tap)
   ↓
2. Gesture Handler recognizes gesture
   ↓
3. Event handler updates component state
   ↓
4. Component re-renders with new data
   ↓
5. UI updates with animations/transitions
   ↓
6. Offline cache updated if data changed
```

---

## Validation & Constraints

### Touch Target Validation
- All interactive elements: min 44x44px
- Adjacent targets: min 8px spacing
- Contrast ratio: 4.5:1 text, 3:1 UI components

### Performance Constraints
- JS bundle: <170KB gzipped
- CSS bundle: <50KB gzipped
- TTI: <5s on 3G (1.6 Mbps)
- FCP: <2s on 3G
- CLS: <0.1

### Accessibility Requirements
- ARIA labels on all interactive elements
- Semantic HTML structure
- Keyboard navigation support
- Screen reader compatibility
- Reduced motion support

---

## Cache Invalidation Strategy

**Automatic Cleanup**:
- On app load: Delete entries older than 7 days
- On write: Check entry age, remove stale data
- On storage quota exceeded: LRU eviction

**Manual Invalidation**:
- User-triggered refresh: Clear specific cache keys
- Version mismatch: Clear entire cache
- Error state: Clear corrupted entries

---

## Error Handling

**Network Errors**:
- Show friendly error message
- Provide manual retry button
- Auto-retry after 30 seconds

**Cache Errors**:
- Fallback to network request
- Log error to console
- Show stale data warning if available

**Validation Errors**:
- Prevent invalid state updates
- Log validation failures
- Display user-friendly error messages

---

## Future Enhancements (Out of Scope for v1)

- Background sync API for offline changes
- Push notifications
- Service worker update notifications
- Advanced cache strategies (network-first, cache-first)
- Preloading/prefetching strategies
