# Implementation Plan: Repository Comparison Dashboard

**Branch**: `001-repo-comparison-dashboard` | **Date**: 2026-01-02 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from [docs/spec/001-repo-comparison-dashboard/spec.md](./spec.md)

## Summary

Build an interactive, world-class repository comparison dashboard deployed to GitHub Pages that allows users to explore all public repositories for a configured GitHub username. The dashboard displays comprehensive metrics (language, first/last commit dates, total commits, average/biggest/smallest commit sizes) in a sortable, filterable table with rich data visualizations (bar charts, line graphs, scatter plots) and side-by-side repository comparisons. The system uses a Python backend for GitHub API data collection generating JSON files, and a React + Vite + Recharts + CSS Modules frontend for an immersive, interactive user experience with smooth animations, drill-down details, and responsive tooltips. Automated GitHub Actions workflow regenerates and deploys dashboard on repository push.

## Technical Context

**Language/Version**: Python 3.11+ (backend data collection), Node.js 18+ (frontend build), React 18+ (UI framework)
**Primary Dependencies**:
- Backend: PyGithub 2.1.1+, PyYAML 6.0.1+, anthropic 0.40.0+, tenacity 9.0.0+
- Frontend: React 19.2.3, Vite 7.3.0, Recharts 3.6.0, CSS Modules (built-in with Vite), ESLint 9.39.2, Prettier 3.7.4
**Storage**: Static JSON files generated by Python backend to `/data` directory, copied to `/docs/data` during build, served via GitHub Pages
**Testing**: pytest (Python backend), Vitest (React frontend), contract testing for JSON schema validation
**Target Platform**:
- Backend: GitHub Actions runners (Ubuntu latest)
- Frontend: Modern browsers (Chrome, Firefox, Safari, Edge - latest 2 versions)
- Deployment: GitHub Pages (static hosting at username.github.io/github-stats-spark)
**Project Type**: Web application (Python backend + React frontend)
**Performance Goals**:
- Backend: Data collection <5 minutes for users with 500 repositories
- Frontend: Initial page load <3 seconds, table sort/filter <1 second, chart rendering <2 seconds
- Build: Production bundle <600KB total (site.js <500KB, site.css <100KB gzipped)
**Constraints**:
- GitHub API rate limits (5000 requests/hour authenticated)
- Static deployment (no server-side runtime)
- Single GitHub username configuration (not multi-user)
- GitHub Pages 1GB soft limit for repository size
**Scale/Scope**:
- Up to 200 public repositories per user
- Up to 100,000 total commits across all repositories
- Dashboard single-page application (~15-20 React components)
- 3-5 visualization types (bar, line, scatter, comparison view)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Applicable Principles from Stats Spark Constitution

**I. Python-First** ✅ COMPLIANT
- Backend data collection is implemented as importable Python modules (`src/spark/`)
- Business logic for GitHub API fetching, metrics calculation, and JSON generation is testable independently
- Separation of concerns: `fetcher.py` (API), `calculator.py` (metrics), new `dashboard_generator.py` (JSON output)

**II. CLI Interface** ✅ COMPLIANT
- Functionality will be accessible via CLI commands:
  - `spark generate --user <username> --dashboard` - Generate dashboard data
  - `spark preview --dashboard` - Preview dashboard locally
- Entry points: `src/main.py` (GitHub Actions), `src/spark/cli.py` (local development)

**III. Data Privacy (NON-NEGOTIABLE)** ✅ COMPLIANT
- System processes ONLY public repositories (constitution requirement: `exclude_private: true`)
- No private repository data, tokens, or credentials persisted to JSON output
- All API calls filter for public repository visibility

**IV. Testability** ✅ COMPLIANT
- Unit tests for new commit size calculations (average, min, max)
- Integration tests for JSON schema validation (dashboard data contract)
- Frontend component tests using Vitest + React Testing Library
- Test fixtures: `tests/fixtures/sample_dashboard_data.json`
- Coverage target: >80% for new `dashboard_generator.py` and React components

**V. Observable** ✅ COMPLIANT
- All GitHub API calls logged with timestamps and rate limit status
- Dashboard generation progress logged (repository processing, JSON writes)
- Frontend errors logged to browser console with context
- GitHub Actions logs show: Python execution → JSON generation → Vite build → deployment

### Additional Constitutional Considerations

**Performance & Scalability Standards** ✅ COMPLIANT
- API Rate Limiting: 6-hour cache TTL maintained for GitHub API responses
- Execution Time: Statistics generation <5 minutes for <500 repositories (existing requirement)
- Accuracy: Commit metrics calculated from GitHub API data with <1% discrepancy

**Configuration & Customization** ⚠️ REQUIRES EXTENSION
- Current `config/spark.yml` specifies single user: `user: markhazleton`
- Dashboard configuration will extend `spark.yml`:
  ```yaml
  dashboard:
    enabled: true
    output_dir: docs
    visualizations:
      - table
      - bar_chart
      - line_graph
      - scatter_plot
      - comparison
  ```

**Governance** ✅ COMPLIANT
- Demo account: `markhazleton` GitHub account remains canonical test user
- Version bump: This is a new feature → MINOR version bump (e.g., 1.1.0)
- Development guidance: Using `docs/spec/001-repo-comparison-dashboard/plan.md` as technical reference

### Constitution Violations

**NONE** - This feature aligns with all constitution principles and extends the existing Python-first architecture with a frontend layer for interactive exploration.

## Project Structure

### Documentation (this feature)

```text
docs/spec/001-repo-comparison-dashboard/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command) - PENDING
├── data-model.md        # Phase 1 output (/speckit.plan command) - PENDING
├── quickstart.md        # Phase 1 output (/speckit.plan command) - PENDING
├── contracts/           # Phase 1 output (/speckit.plan command) - PENDING
│   ├── dashboard-data.schema.json    # JSON schema for dashboard data
│   └── component-api.md              # React component prop interfaces
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
# Backend (Python data collection & processing)
src/spark/
├── fetcher.py                    # [EXISTING] GitHub API interactions
├── calculator.py                 # [EXISTING] Statistics calculations
├── visualizer.py                 # [EXISTING] SVG generation
├── dashboard_generator.py        # [NEW] JSON generation for dashboard
├── models/
│   ├── commit.py                 # [EXISTING] Commit data model
│   ├── repository.py             # [EXISTING] Repository data model
│   └── dashboard_data.py         # [NEW] Dashboard JSON structure model
└── cli.py                        # [EXTENDED] Add dashboard commands

# Frontend (React interactive dashboard)
frontend/
├── package.json                  # npm dependencies (React, Vite, Recharts)
├── vite.config.js                # Vite build configuration
├── src/
│   ├── main.jsx                  # React app entry point
│   ├── App.jsx                   # Root component (router, layout)
│   ├── components/
│   │   ├── RepositoryTable/
│   │   │   ├── RepositoryTable.jsx
│   │   │   ├── RepositoryTable.module.css
│   │   │   ├── TableRow.jsx
│   │   │   └── TableHeader.jsx
│   │   ├── Visualizations/
│   │   │   ├── BarChart.jsx
│   │   │   ├── LineGraph.jsx
│   │   │   ├── ScatterPlot.jsx
│   │   │   └── VisualizationControls.jsx
│   │   ├── Comparison/
│   │   │   ├── ComparisonView.jsx
│   │   │   └── ComparisonSelector.jsx
│   │   ├── DrillDown/
│   │   │   ├── RepositoryDetail.jsx
│   │   │   └── RepositoryDetail.module.css
│   │   └── Common/
│   │       ├── Tooltip.jsx
│   │       ├── FilterControls.jsx
│   │       └── LoadingState.jsx
│   ├── services/
│   │   ├── dataService.js        # Fetch dashboard JSON
│   │   └── metricsCalculator.js  # Client-side metric utilities
│   ├── hooks/
│   │   ├── useRepositoryData.js  # Data fetching hook
│   │   └── useTableSort.js       # Sorting/filtering logic
│   └── styles/
│       └── global.css            # Global styles and CSS variables
└── public/
    └── index.html                # HTML template

# Build Output (GitHub Pages deployment target)
docs/                             # [RENAME FROM CURRENT docs/ → documentation/]
├── index.html                    # Built React app entry point
├── assets/
│   ├── site-[hash].js            # Bundled React app + libraries
│   └── site-[hash].css           # Bundled CSS Modules styles
└── data/
    ├── repositories.json         # Repository metrics data
    ├── profile.json              # User profile data
    └── visualizations.json       # Pre-generated SVG paths

# GitHub Actions Workflow
.github/workflows/
└── generate-stats.yml            # [EXTENDED] Add frontend build steps

# Tests
tests/
├── unit/
│   ├── test_dashboard_generator.py    # [NEW] JSON generation tests
│   └── test_commit_metrics.py         # [NEW] Commit size calculation tests
├── integration/
│   └── test_json_schema.py            # [NEW] Contract validation tests
├── contract/
│   └── test_dashboard_api.py          # [NEW] JSON structure tests
└── fixtures/
    └── sample_dashboard_data.json     # [NEW] Test data fixture

frontend/tests/
├── components/
│   ├── RepositoryTable.test.jsx
│   └── BarChart.test.jsx
└── services/
    └── dataService.test.js
```

**Structure Decision**: Web application architecture selected due to frontend + backend split. Python backend generates JSON data during GitHub Actions workflow. React frontend fetches and renders JSON at runtime in the browser. Build process outputs to `/docs` directory for GitHub Pages static hosting. Current `/docs` directory will be renamed to `/documentation` to free up `/docs` for GitHub Pages publishing (as per clarification in spec.md line 20).

## Complexity Tracking

**No violations to justify** - This feature extends the existing architecture following all constitution principles.

---

## Phase 0: Outline & Research

### Research Tasks

The following unknowns from Technical Context require investigation:

1. **Recharts Integration Patterns**
   - Task: Research Recharts best practices for interactive dashboards in React
   - Focus: Component composition, responsive sizing, tooltip customization, animation performance

2. **Vite Build Optimization**
   - Task: Find Vite production build best practices for single-bundle output
   - Focus: Code splitting strategies, CSS Modules extraction, bundle size optimization, tree-shaking

3. **GitHub Pages Deployment from /docs**
   - Task: Research GitHub Pages configuration for React SPA deployment from /docs directory
   - Focus: Base URL configuration, routing fallbacks, asset path resolution

4. **Commit Size Calculation Methodology**
   - Task: Research GitHub API commit metrics and best practices for measuring commit size
   - Focus: Files changed vs. lines changed, handling merge commits, binary file changes

5. **JSON Data Schema Design**
   - Task: Find best practices for JSON data structure for frontend consumption
   - Focus: Denormalization strategies, pagination alternatives for large datasets, schema versioning

6. **React Performance for Large Datasets**
   - Task: Research React patterns for rendering 100+ row tables with sub-second sort/filter
   - Focus: Virtualization (react-window), memoization, useCallback/useMemo patterns

7. **CSS Modules with Recharts Integration**
   - Task: Research CSS Modules best practices for styling third-party chart libraries
   - Focus: Global vs. scoped styles, CSS variable injection, theme switching

### Output Deliverable

`research.md` with consolidated findings in the format:
- **Decision**: [technology/approach chosen]
- **Rationale**: [why this choice best meets requirements]
- **Alternatives considered**: [what else was evaluated and rejected]

---

## Phase 1: Design & Contracts

**Prerequisites:** `research.md` complete (all unknowns resolved)

### 1. Data Model Generation (`data-model.md`)

Extract entities from feature specification (spec.md lines 207-218):

**Entities**:
- **Repository**: name, primary_language, created_at, updated_at, commit_count, first_commit_date, last_commit_date, avg_commit_size, largest_commit, smallest_commit
- **Commit**: sha, date, files_changed, lines_added, lines_deleted, size (calculated field)
- **User Profile**: username, avatar_url, public_repos_count, total_commits, total_stars, total_forks
- **Visualization Configuration**: chart_type, selected_metrics, filter_criteria, comparison_repos
- **Dashboard Data**: repositories[], profile, metadata (generated_at, schema_version)

**Validation Rules**:
- Repository name: non-empty string
- Commit counts: non-negative integers
- Dates: ISO 8601 format
- Commit size: files_changed + lines_added + lines_deleted (sum)
- Language: nullable string (default "Unknown")

**State Transitions**:
- Dashboard data: generated (Python) → fetched (React) → rendered (UI)
- User interactions: idle → filtering → filtered, idle → sorting → sorted, idle → comparing → comparison_active

### 2. API Contracts Generation (`contracts/`)

**dashboard-data.schema.json** (JSON Schema):
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dashboard Data Contract",
  "type": "object",
  "required": ["repositories", "profile", "metadata"],
  "properties": {
    "repositories": {
      "type": "array",
      "items": { "$ref": "#/definitions/Repository" }
    },
    "profile": { "$ref": "#/definitions/Profile" },
    "metadata": {
      "type": "object",
      "properties": {
        "generated_at": { "type": "string", "format": "date-time" },
        "schema_version": { "type": "string", "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$" }
      }
    }
  },
  "definitions": {
    "Repository": {
      "type": "object",
      "required": ["name", "language", "created_at", "last_commit_date", "commit_count"],
      "properties": {
        "name": { "type": "string" },
        "language": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" },
        "last_commit_date": { "type": "string", "format": "date-time" },
        "first_commit_date": { "type": "string", "format": "date-time" },
        "commit_count": { "type": "integer", "minimum": 0 },
        "avg_commit_size": { "type": "number", "minimum": 0 },
        "largest_commit": { "$ref": "#/definitions/CommitMetric" },
        "smallest_commit": { "$ref": "#/definitions/CommitMetric" }
      }
    },
    "CommitMetric": {
      "type": "object",
      "properties": {
        "sha": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "size": { "type": "number", "minimum": 0 }
      }
    },
    "Profile": {
      "type": "object",
      "required": ["username"],
      "properties": {
        "username": { "type": "string" },
        "avatar_url": { "type": "string", "format": "uri" },
        "public_repos_count": { "type": "integer" }
      }
    }
  }
}
```

**component-api.md** (React Component Interfaces):
```typescript
// RepositoryTable Component
interface RepositoryTableProps {
  repositories: Repository[];
  onSort: (column: string, direction: 'asc' | 'desc') => void;
  onFilter: (filterConfig: FilterConfig) => void;
  onSelectRepo: (repoName: string) => void;
}

// VisualizationControls Component
interface VisualizationControlsProps {
  chartType: 'bar' | 'line' | 'scatter';
  onChartTypeChange: (type: string) => void;
  selectedMetrics: string[];
  onMetricsChange: (metrics: string[]) => void;
}

// ComparisonView Component
interface ComparisonViewProps {
  selectedRepos: Repository[];
  onRemoveRepo: (repoName: string) => void;
}

// RepositoryDetail Component (Drill-down)
interface RepositoryDetailProps {
  repository: Repository;
  analysis: RepositoryAnalysis; // From existing unified report
  onClose: () => void;
}
```

### 3. Quickstart Guide (`quickstart.md`)

**Local Development Setup**:
```bash
# Backend (Python)
cd src
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
export GITHUB_TOKEN=your_token_here
python -m spark.cli generate --user markhazleton --dashboard

# Frontend (React)
cd frontend
npm install
npm run dev  # Vite dev server at http://localhost:5173

# Production Build
npm run build  # Output to ../docs/
```

**GitHub Pages Deployment**:
1. Rename current `/docs` → `/documentation`
2. Configure GitHub Pages: Settings → Pages → Source: `/docs` folder on `main` branch
3. Push to `main` branch → GitHub Actions builds and deploys
4. Access at: https://markhazleton.github.io/github-stats-spark

### 4. Agent Context Update

Run agent context update scripts:
```bash
.specify/scripts/powershell/update-agent-context.ps1 -AgentType claude
```

Add new technologies from this plan:
- React 18+ (UI framework)
- Vite 5+ (build tool)
- Recharts 2.x (data visualization)
- CSS Modules (styling)

Preserve manual additions between `<!-- MANUAL ADDITIONS START -->` and `<!-- MANUAL ADDITIONS END -->` markers.

---

## Phase 2: Stop and Report

This phase is executed by the `/speckit.tasks` command (NOT by `/speckit.plan`).

**Expected Report After Phase 1**:
- Branch: `001-repo-comparison-dashboard`
- Implementation Plan: [docs/spec/001-repo-comparison-dashboard/plan.md](./plan.md)
- Generated Artifacts:
  - ✅ `research.md` (Phase 0 output)
  - ✅ `data-model.md` (Phase 1 output)
  - ✅ `contracts/dashboard-data.schema.json` (Phase 1 output)
  - ✅ `contracts/component-api.md` (Phase 1 output)
  - ✅ `quickstart.md` (Phase 1 output)
  - ⏳ `tasks.md` (Phase 2 - generated by `/speckit.tasks` command)

**Next Steps**:
1. Review and approve this implementation plan
2. Execute `/speckit.tasks` to generate `tasks.md` with actionable, dependency-ordered implementation tasks
3. Execute `/speckit.implement` to begin implementation workflow

---

## Open Questions (To Be Resolved in Phase 0 Research)

1. Should React Router be used for URL-based navigation between table/charts/comparison views, or is state-based routing sufficient for a single-page dashboard?
2. What is the optimal JSON file structure: single large `repositories.json` vs. separate files per repository vs. paginated chunks?
3. Should the dashboard support exporting filtered/sorted data to CSV/JSON (FR-020), and if so, should this be client-side (FileSaver.js) or backend-generated?
4. How should the drill-down view integrate existing SVG visualizations from Stats Spark (FR-029, FR-030)?
5. What is the best approach for handling very large repositories (10,000+ commits) without API rate limit exhaustion?

**Resolution Path**: These questions will be answered in Phase 0 research and documented in `research.md` with clear decisions and rationales.
